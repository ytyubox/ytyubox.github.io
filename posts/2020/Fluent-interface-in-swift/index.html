<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"/><meta name="og:site_name" content="æ¸¸è«­ Swift Dev ğŸ¦„"/><link rel="canonical" href="https://ytyubox.github.io/posts/2020/Fluent-interface-in-swift"/><meta name="twitter:url" content="https://ytyubox.github.io/posts/2020/Fluent-interface-in-swift"/><meta name="og:url" content="https://ytyubox.github.io/posts/2020/Fluent-interface-in-swift"/><meta name="google-site-verification" content="laa-5denPCh-d7LKKq_HLxpcMTXZa1R2OSU8L19KmM0"/><title>é‹ç”¨æ³›å‹å¯¦ç¾ Fluent interface Setter | æ¸¸è«­ Swift Dev ğŸ¦„</title><meta name="twitter:title" content="é‹ç”¨æ³›å‹å¯¦ç¾ Fluent interface Setter | æ¸¸è«­ Swift Dev ğŸ¦„"/><meta name="og:title" content="é‹ç”¨æ³›å‹å¯¦ç¾ Fluent interface Setter | æ¸¸è«­ Swift Dev ğŸ¦„"/><meta name="description" content="ä»‹ç´¹ Fluent interface åŠåœ¨ Swift çš„å¯¦ä½œ"/><meta name="twitter:description" content="ä»‹ç´¹ Fluent interface åŠåœ¨ Swift çš„å¯¦ä½œ"/><meta name="og:description" content="ä»‹ç´¹ Fluent interface åŠåœ¨ Swift çš„å¯¦ä½œ"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to æ¸¸è«­ Swift Dev ğŸ¦„"/><meta name="twitter:image" content="https://ytyubox.github.io/images/logo.png"/><meta name="og:image" content="https://ytyubox.github.io/images/logo.png"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">æ¸¸è«­ Swift Dev ğŸ¦„</a><div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-155763530-1"></script><script>				window.dataLayer = window.dataLayer || [];
				function gtag(){dataLayer.push(arguments);}
				gtag('js', new Date());
				gtag('config', 'UA-155763530-1');</script></div><nav><ul><li><a class="selected" href="/posts">posts</a></li><li><a href="/about">About</a></li></ul></nav></div></header><div class="fb-root"><script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v5.0&appId=1443810799117142&autoLogAppEvents=1"></script></div><div class="wrapper"><article><div class="content"><img src="https://i.imgur.com/YOSTX3P.png"/><h1>é‹ç”¨æ³›å‹å¯¦ç¾ Fluent interface Setter</h1><p>Fluent Interface(FI)ï¼Œåˆåæµå¼æ¥å£ï¼Œæ˜¯ä¸€ç¨®åœ¨ç¨‹å¼ç·¨å¯«çš„æ–¹å¼ï¼Œé€™ç¯‡æ–‡ç« å°‡æè¿° FI çš„æ„ç¾©èˆ‡å¦‚ä½•åœ¨ Swift 5.1 å¯¦ä½œã€‚</p><h2>ä»€éº¼æ˜¯ Fluent interface</h2><p>æµå¼æ¥å£å¯ä»¥å°‡æŒ‡ä»¤å¼èªè¨€è½‰åŒ–æˆå®£å‘Šå¼èªè¨€ï¼Œä½¿ç°¡æ˜“çš„é‚è¼¯åˆ¤æ–·æ¶ˆå¤±ï¼Œé€²è€ŒåŠ å¼·ç¨‹å¼ç¢¼çš„å¯è®€æ€§ã€‚åœ¨ FI ä¸­æœ‰è¨±å¤šæ‡‰ç”¨ï¼Œæˆ‘åˆ†æˆäº† 3 ç¨®é¡å‹ <code>Transformer</code>, <code>Getter</code>, <code>Setter</code>ã€‚</p><h3>Transformer</h3><p>æˆ‘å€‘åœ¨æ“ä½œé›†åˆé¡å‹çš„æ™‚å€™ï¼Œå¸¸å¸¸ä½¿ç”¨ filterã€mapã€reduceï¼Œåƒæ˜¯ï¼š</p><pre><code><span class="keyword">let</span> input = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]
<span class="keyword">let</span> output = input.<span class="call">map</span>(<span class="type">String</span>.<span class="property">init</span>)
</code></pre><p>ç›¸æ¯”æ²’æœ‰ä½¿ç”¨ <code>map</code> å‡½å¼ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ for in è¿´åœˆä¾†è™•ç†ï¼š</p><pre><code><span class="keyword">let</span> input = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]
<span class="keyword">var</span> output = [<span class="type">String</span>]()
<span class="keyword">for</span> value <span class="keyword">in</span> input {
    output.<span class="call">append</span>(<span class="type">String</span>(value))
}
</code></pre><p>åœ¨ map å‡½å¼ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åŸå…ˆçš„ input æ˜¯ä¸€å€‹ <code>let</code> çš„è®Šæ•¸ï¼Œæ˜é¡¯å¯ä»¥çœ‹åˆ° output çš„ç”Ÿæˆä¸æœƒæ”¹è®Šä¾†æºçš„æ•¸å€¼ï¼Œå› æ­¤ä»–æ˜¯ä¸€ç¨® <code>Transform</code> çš„åŠŸèƒ½ã€‚</p><h3>Getter</h3><p>åœ¨ä¸€äº›å¸¸è¦‹çš„ç¨‹å¼èªè¨€ä¸­å¸¸æœ‰ç©ºçš„æ¦‚å¿µ(Null)ï¼Œå°¤å…¶åœ¨ Swift ä¸­æ›´æ˜¯å€‹ä¸èƒ½å¿½ç•¥çš„äº‹æƒ…ã€‚ç•¶æˆ‘å€‘è¦ä½¿ç”¨ä¸€å€‹å·¢ç‹€å‹åˆ¥å¦‚ä¸‹ï¼š</p><pre><code><span class="keyword">struct</span> Person {
    <span class="keyword">var</span> name:<span class="type">String</span>
    <span class="keyword">var</span> pet:<span class="type">Pet</span>?
    <span class="keyword">struct</span> Pet {
        <span class="keyword">var</span> petName:<span class="type">String</span>
        <span class="keyword">var</span> speakSound: <span class="type">String</span>?
    }
}
</code></pre><p>æˆ‘å€‘æœ‰ä¸€å€‹ Person å‹åˆ¥ï¼Œé€™å€‹ Person æœ‰å¿…é ˆçš„ name å±¬æ€§ï¼Œå’Œä¸€å€‹éå¿…é ˆçš„ pet å±¬æ€§(Petå‹åˆ¥)ï¼Œè€Œé€™å€‹ Pet æœ‰å¿…é ˆçš„ petNameï¼Œå’Œä¸€å€‹éå¿…é ˆçš„ speakSoundã€‚å‡å¦‚æˆ‘å€‘éœ€è¦å–å¾—æ‰€æœ‰ person çš„ pet çš„speakSoundï¼Œç‚ºäº†é¿å…ç©ºçš„å•é¡Œï¼Œæˆ‘å€‘å¯ä»¥ç”¨ if else ä¾†è™•ç†ï¼š</p><pre><code><span class="comment">// [é€²éš]ï¼šç‚ºäº†é¿å…èª¤è§£ï¼Œæˆ‘çœç•¥äº† Implicitly Unwrapped Optional</span>

<span class="keyword">let</span> theMan = <span class="type">Person</span>(name: <span class="string">"Yu"</span>, 
                    pet: <span class="type">Pet</span>(petName: <span class="string">"dog"</span>, speakSound: <span class="string">"bark"</span>))
                    
<span class="keyword">if</span> theMan.<span class="property">pet</span> != <span class="keyword">nil</span> {
    <span class="keyword">if</span> theMan.<span class="property">pet</span>.<span class="property">speakSound</span> != {
        <span class="call">print</span>(theMan.<span class="property">pet</span>.<span class="property">speakSound</span>) <span class="comment">// bark</span>
    }
}
</code></pre><p>è€Œåœ¨ Swift ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ Optional chaining ä¾†å°‡é€™å€‹åˆ¤æ–·å°è£èµ·ä¾†ï¼š</p><pre><code><span class="keyword">let</span> theWoman = <span class="type">Person</span>(name: <span class="string">"Swift"</span>, 
                      pet: tir)
<span class="call">print</span>(theWoman.<span class="property">pet</span>?.<span class="property">speakSound</span> ?? <span class="string">"..."</span>) <span class="comment">// ...</span>
</code></pre><p>åœ¨é€™å€‹ä¾‹å­ï¼Œæˆ‘å€‘çœ‹åˆ°ä½¿ç”¨ Optional chaining å¯ä»¥å¤§å¹…ç°¡åŒ–ç¨‹å¼ç¢¼çš„è¤‡é›œæƒ…æ³ï¼Œè®“å–å¾—ç‰©ä»¶ property çš„ç¨‹å¼å¯ä»¥ä¸éœ€è¦æ˜é¡¯çš„é‚è¼¯åˆ¤æ–·ï¼Œè€Œæ˜¯å°‡åˆ¤æ–·å°è£è‡³ <code>?</code> é€™å€‹é‹ç®—ç¬¦è™Ÿã€‚</p><h3>Setter</h3><p>åœ¨ç‰©ä»¶å°å‘è¨­è¨ˆæ¨¡å¼ä¸­ï¼Œæœ‰ä¸€å€‹ Builder æ¨¡å¼(ç”Ÿæˆå™¨æ¨¡å¼)ï¼Œå®ƒå¯ä»¥å°‡è¤‡é›œå°è±¡çš„å»ºé€ éç¨‹æŠ½è±¡å‡ºä¾†ï¼ˆæŠ½è±¡é¡åˆ¥ï¼‰ï¼Œä½¿é€™å€‹æŠ½è±¡éç¨‹çš„ä¸åŒå¯¦ç¾æ–¹æ³•å¯ä»¥æ§‹é€ å‡ºä¸åŒè¡¨ç¾ï¼ˆå±¬æ€§ï¼‰çš„å°è±¡ã€‚ <img src="https://i.imgur.com/TvKtVxO.png"/> åœ–ç‰‡ä¾†è‡ª https://en.wikipedia.org/wiki/Builder_pattern</p><p>åœ¨ Swift Foundation ä¸­ï¼Œ<a href="https://developer.apple.com/documentation/foundation/datecomponents">DateComponents</a> æ˜¯ä¸€å€‹å¸¸è¦‹çš„ Builderï¼š</p><pre><code><span class="keyword">var</span> dateComponents = <span class="type">DateComponents</span>()
dateComponents.<span class="property">calendar</span> = .<span class="dotAccess">current</span>
dateComponents.<span class="property">year</span> = <span class="number">2020</span>
dateComponents.<span class="property">month</span> = <span class="number">3</span>
dateComponents.<span class="property">day</span> = <span class="number">14</span>
dateComponents.<span class="property">hour</span> = <span class="number">1</span>
dateComponents.<span class="property">minute</span> = <span class="number">20</span>
dateComponents.<span class="property">second</span> = <span class="number">59</span>
dateComponents.<span class="property">date</span> <span class="comment">// 2020-03-13 17:20:59 +0000</span>
</code></pre><p>è€Œåœ¨æˆ‘çš„ <a href="https://github.com/ytyubox/fluentinterface">FluentInterface</a> é€™å€‹ Swift Package ä¸­ï¼Œæˆ‘å€‘å¯ä»¥æ”¹è®Šé€™å€‹é€æ­¥è³¦å€¼çš„æ–¹å¼ï¼š</p><pre><code><span class="keyword">let</span> dateComponents = <span class="type">DateComponents</span>()+
                      .<span class="call">calendar</span>(.<span class="dotAccess">current</span>)
                      .<span class="call">year</span>(<span class="number">2020</span>)
                      .<span class="call">month</span>(<span class="number">3</span>)
                      .<span class="call">day</span>(<span class="number">14</span>)
                      .<span class="call">hour</span>(<span class="number">1</span>)
                      .<span class="call">minute</span>(<span class="number">20</span>)
                      .<span class="call">second</span>(<span class="number">59</span>)
                      .<span class="call">unwrappingSubject</span>()
                      .<span class="dotAccess">date</span>
dateComponents.<span class="property">date</span> <span class="comment">// 2020-03-13 17:20:59 +0000</span>
</code></pre><p>æ˜¯ä¸æ˜¯ç›¸å°çš„æ›´ç›´è¦ºä¸€äº›å‘¢ï¼</p><h2>FluentInterface çš„ä¸å¥½åœ°æ–¹</h2><img src="https://i.imgur.com/vEGbZlJ.png"/><p>åœ¨ 2019 å¹´ appcode.com.tw çš„ https://www.appcoda.com.tw/fluent-interface/ æ–‡ç« ä¸­ï¼Œæˆ‘å—åˆ°ä¸å°‘å•Ÿç™¼ï¼Œç‰¹åˆ¥åˆ†äº«é€™ç¯‡å¥½æ–‡ç« ã€‚ 2020 å¹´ 3 æœˆæ™‚æˆ‘åœ¨ CocoaHeads Taipei åˆ†äº«äº†é€™å€‹ repoï¼Œæ„Ÿè¬å…¶ä»–èˆ‡æœƒçš„é–‹ç™¼è€…æå•æœ‰é—œæ–¼æ•ˆèƒ½çš„å•é¡Œï¼Œæ˜¯çš„ FI æ•ˆç‡å¾ˆä¸å¥½ï¼Œåœ¨é€£çºŒ 1<em>000</em>000 çš„ Object ç”Ÿæˆä¸¦ è³¦äºˆ 60 å€‹ä¸åŒ property ç›¸åŒæ•¸å€¼æ™‚ï¼Œè‹¥ä½¿ç”¨åŒ¿åå‡½å¼(Anonymous Function)ï¼Œå–®å…ƒæ¸¬è©¦é¡¯ç¤º 10 æ¬¡åŸ·è¡Œå¹³å‡æ™‚é–“ç´„ç‚º <code>0.810 ç§’</code>ï¼› è€Œ FluentInterface å¯¦æ¸¬åŒæ¨£æ¢ä»¶éœ€è¦ <code>15.796</code> ç§’ã€‚å› æ­¤åœ¨ä½¿ç”¨ FI çš„æ™‚å€™ï¼Œè€ƒæ…®æ•ˆèƒ½åœ¨å¤§æ•¸é‡çš„ç‹€æ³æ˜¯å¿…é ˆæ³¨æ„çš„ã€‚</p><img src="https://i.imgur.com/wbio12T.jpg"/><p>ç·šä¸Šçš„ CocoaHeads Taipei èšæœƒ</p><p>æ–‡æœ«ç‰¹åˆ¥æ„Ÿè¬è¨±ç«‹æ†ã€é™³æ¶µå®‡ç­‰ç­‰é–‹ç™¼è€…ã€‚</p></div><span>Tagged with: </span><ul class="tag-list"><li class="variant-s"><a href="/tags/swift">swift</a></li><li class="variant-é¼ "><a href="/tags/é¼ å¹´å…¨é¦¬æŒ‘æˆ°è³½">é¼ å¹´å…¨é¦¬æŒ‘æˆ°è³½</a></li></ul></article></div><div class="fb-comments" colorscheme="dark" data-width="10" data-herf="https://ytyubox.github.io/posts/2020/Fluent-interface-in-swift" data-numposts="10"></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a>, 100% Swift</p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>