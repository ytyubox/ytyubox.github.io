<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"/><meta name="og:site_name" content="æ¸¸è«­ Swift Dev ğŸ¦„"/><link rel="canonical" href="https://ytyubox.github.io/posts/SwiftCLI-helloworld"/><meta name="twitter:url" content="https://ytyubox.github.io/posts/SwiftCLI-helloworld"/><meta name="og:url" content="https://ytyubox.github.io/posts/SwiftCLI-helloworld"/><meta name="google-site-verification" content="laa-5denPCh-d7LKKq_HLxpcMTXZa1R2OSU8L19KmM0"/><title>ä½¿ç”¨ Swift Package Manager å»ºç«‹ Command line tool | æ¸¸è«­ Swift Dev ğŸ¦„</title><meta name="twitter:title" content="ä½¿ç”¨ Swift Package Manager å»ºç«‹ Command line tool | æ¸¸è«­ Swift Dev ğŸ¦„"/><meta name="og:title" content="ä½¿ç”¨ Swift Package Manager å»ºç«‹ Command line tool | æ¸¸è«­ Swift Dev ğŸ¦„"/><meta name="description" content="å¦‚ä½•ä½¿ç”¨ Swift Package Manager(SPM) èˆ‡ Linux/Unix äº’å‹•"/><meta name="twitter:description" content="å¦‚ä½•ä½¿ç”¨ Swift Package Manager(SPM) èˆ‡ Linux/Unix äº’å‹•"/><meta name="og:description" content="å¦‚ä½•ä½¿ç”¨ Swift Package Manager(SPM) èˆ‡ Linux/Unix äº’å‹•"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to æ¸¸è«­ Swift Dev ğŸ¦„"/><meta name="twitter:image" content="https://ytyubox.github.io/images/logo.png"/><meta name="og:image" content="https://ytyubox.github.io/images/logo.png"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">æ¸¸è«­ Swift Dev ğŸ¦„</a><div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-155763530-1"></script><script>				window.dataLayer = window.dataLayer || [];
				function gtag(){dataLayer.push(arguments);}
				gtag('js', new Date());
				gtag('config', 'UA-155763530-1');</script></div><nav><ul><li><a class="selected" href="/posts">posts</a></li><li><a href="/about">About</a></li></ul></nav></div></header><div class="fb-root"><script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v5.0&appId=1443810799117142&autoLogAppEvents=1"></script></div><div class="wrapper"><article><div class="content"><h1>ä½¿ç”¨ Swift Package Manager å»ºç«‹ Command line tool</h1><p>Command line tool æœ‰æ™‚å€™å¯ä»¥æ–¹ä¾¿çš„è™•ç†ä¸€äº›å¸¸è¦‹çš„ä»»å‹™ï¼Œæœ‰æ™‚å€™å¯ä»¥å°‡é–‹æ”¾ä¸­é‡åˆ°çš„ç‘£ç¢äº‹æƒ…è‡ªå‹•åŒ–è™•ç†ï¼Œä¾‹å¦‚ <a href="https://github.com/yonaskolb/XcodeGen">XcodeGen</a>å°±æ˜¯ä¸€å€‹æœ‰è¶£çš„æ‡‰ç”¨ã€‚é€™ç¯‡æ–‡ç« å°‡æ•™ä½ å¦‚ä½•ä½¿ç”¨ Swift Package Manager(SPM) èˆ‡ Linux/Unix äº’å‹•ã€‚</p><h2>å…ˆå‚™çŸ¥è­˜</h2><ol><li>åŸºç¤ Swift èªæ³•çŸ¥è­˜ï¼Œè‹¥ä»¥ Swift.org çš„Language guide ç›®éŒ„ç‚ºæ¨™æº–ï¼Œå‰‡æ˜¯ <code>The Basic</code> è‡³ <code>Methods</code>ã€‚</li><li>åŸºç¤ Swift <code>Package.init</code> åƒæ•¸ä½¿ç”¨ï¼Œå¦‚ <code>name</code>, <code>dependencies</code>, <code>targets</code>ã€‚</li><li>åŸºç¤ Linux èªæ³•çŸ¥è­˜ï¼Œå¦‚ <code>ls -alR</code>, <code>Date</code>, <code>whoami</code>ã€‚</li></ol><h2>å»ºç«‹å¯åŸ·è¡Œçš„SPM - Hello world</h2><p>æˆ‘å€‘å¯ä»¥ä½¿ç”¨ Swift package manager ä¾†å»ºç«‹ä¸€å€‹æ–°çš„ Package projectã€‚ å¦‚æœä½ å° terminal ç†Ÿæ‚‰çš„è©±ï¼Œå¯ä»¥é–±è®€æ›´è©³ç´°çš„æ–‡ä»¶ï¼š <a href="https://github.com/apple/swift-package-manager/blob/master/Documentation/Usage.md">Swift-package-manager/Usage.md</a>ã€‚</p><pre><code>$ swift package <span class="keyword">init</span> --type executable --name helloworld
</code></pre><p>é€™æ®µæŒ‡ä»¤åŸ·è¡Œäº†ä¸€ä¸‹äº‹æƒ…ï¼š åœ¨ç•¶å‰ç›®éŒ„å»ºç«‹ä¸€å€‹åç‚º <code>helloworld</code> çš„ å¯åŸ·è¡Œçš„Swift packageã€‚</p><p>ä½ å¯ä»¥çœ‹åˆ°ç•¶å‰ç›®éŒ„å»ºç«‹äº†ä¸€äº›æª”æ¡ˆï¼Œä¸‹é¢æ˜¯ä½¿ç”¨ <a href="https://formulae.brew.sh/formula/tree"><code>tree</code></a> çš„æª”æ¡ˆå¤¾çµæ§‹ï¼š</p><pre><code>.
â”œâ”€â”€ <span class="type">Package</span>.<span class="property">swift</span>
â”œâ”€â”€ <span class="type">README</span>.<span class="property">md</span>
â”œâ”€â”€ <span class="type">Sources</span>/
â”‚Â Â  â””â”€â”€ helloworld/
â”‚Â Â      â””â”€â”€ main.<span class="property">swift</span>
â””â”€â”€ <span class="type">Tests</span>/
    â”œâ”€â”€ <span class="type">LinuxMain</span>.<span class="property">swift</span>
    â””â”€â”€ helloworldTests/
        â”œâ”€â”€ <span class="type">XCTestManifests</span>.<span class="property">swift</span>
        â””â”€â”€ helloworldTests.<span class="property">swift</span>
</code></pre><p>é€™æ™‚æˆ‘å€‘å¯ä»¥é€éä»¥ä¸‹æŒ‡ä»¤ç›´æ¥åŸ·è¡Œé€™å€‹ç¨‹å¼</p><pre><code>$ swift build
$ swift run
<span class="type">Hello</span>, world!
</code></pre><p>å¦‚æ­¤ä¸€ä¾†å°±å®ŒæˆåŸºç¤çš„ Command line tool äº†ï¼</p><h2><code>Package.swift</code> å–ä»£äº† <code>.xcodeproj</code></h2><p>è‹¥æ˜¯ä½ æœ‰ Xcode 11, å¯ä»¥ç›´æ¥æ‰“é–‹ <code>Package.swift</code> å°±æœƒè‡ªå‹• link æ‰€æœ‰æª”æ¡ˆä¸¦å»ºç«‹ <code>.swiftpm</code></p><pre><code>$ <span class="keyword">open</span> <span class="type">Package</span>.<span class="property">swift</span>
</code></pre><p>å¯ä»¥çœ‹åˆ° Package.swift æˆç‚ºåœ¨ XCode çš„ç¬¬ä¸€å€‹æª”æ¡ˆï¼Œä»¥å¾€ç†Ÿæ‚‰çš„ <code>.xcodeproj</code>ä¸è¦‹äº†ã€‚</p><img src="https://i.imgur.com/0e7f6XY.png"/><h2>åœ¨åŸ·è¡Œæª”ä½¿ç”¨ç¬¬ä¸‰æ–¹å‡½å¼åº«</h2><p>åœ¨é€™è£æˆ‘å€‘ç‚º helloworld å¢åŠ è®€å– arguments çš„åŠŸèƒ½ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨å…¶ä»–å·²ç¶“å®Œå–„çš„ç¬¬ä¸‰æ–¹å‡½å¼åº«ï¼Œé€™æ¬¡æˆ‘å€‘ä½¿ç”¨ <code>SPMUtility</code>ï¼Œ é€™æ˜¯ä¾†è‡ª Apple çš„é–‹æºå°ˆæ¡ˆï¼ŒSPM å¯ä»¥é€é Git ç›®éŒ„çš„è®€å–ï¼ŒåŸ·è¡Œå¥—ä»¶ç®¡ç†ä¸¦å®‰è£åˆ°å°ˆæ¡ˆä¸­ã€‚æˆ‘å€‘åœ¨ <code>Package.swift</code> ä¸­å¥—ç”¨ä»¥ä¸‹çš„ä¿®æ”¹ï¼š</p><pre><code><span class="comment">// swift-tools-version:5.1</span>

<span class="keyword">import</span> PackageDescription

<span class="keyword">let</span> package = <span class="type">Package</span>(
	name: <span class="string">"helloworld"</span>,
	dependencies: [
		.<span class="call">package</span>(url: <span class="string">"https://github.com/apple/swift-package-manager.git"</span>, from: <span class="string">"0.1.0"</span>)
	],
	targets: [
		.<span class="call">target</span>(
			name: <span class="string">"helloworld"</span>,
			dependencies: [<span class="string">"SPMUtility"</span>]),
		.<span class="call">testTarget</span>(
			name: <span class="string">"helloworldTests"</span>,
			dependencies: [<span class="string">"helloworld"</span>]),
	]
)
</code></pre><blockquote><p>å› ç‚ºå‡½å¼åº«çš„å¤§å°è¼ƒå¤§ï¼Œå»ºè­°ç¶²è·¯é€Ÿåº¦è¼ƒæ…¢çš„è®€è€…åœ¨é€™è£å…ˆå›åˆ° terminal åŸ·è¡Œ <code>swift build</code>ã€‚</p></blockquote><p>è¦æ³¨æ„ä¸€æ—¦ç·¨è¼¯ <code>Package.swift</code> æª”å¾Œï¼Œå¿…é ˆä½¿ç”¨ä¸»å‹•å„²å­˜è®Šæ›´ï¼ŒXCode æ‰æœƒæ›´æ–°å°ˆæ¡ˆï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ File &gt; Save ä¾†ä¸»å‹•å„²å­˜ã€‚ <img src="https://i.imgur.com/S0KXjw8.png"/></p><h2>ä½¿ç”¨ <code>SPMUtility</code> è®€å– Arguments èˆ‡æ”¯æ´å…¶ä»–æ‡‰ç”¨ã€‚</h2><p>ç‚ºäº†å¯¦ç¾è®€å– Arguments çš„åŠŸèƒ½ï¼Œæˆ‘å€‘è¦åˆ° <code>main.swift</code> ç·¨å¯«ç¨‹å¼ç¢¼ï¼</p><p>é¦–å…ˆï¼Œé€šé import Foundationï¼Œæˆ‘å€‘å–å¾—ä½¿ç”¨è€…è¼¸å…¥çš„ Argumentsã€‚</p><pre><code><span class="keyword">import</span> Foundation
<span class="keyword">import</span> SPMUtility

<span class="keyword">let</span> arguments = <span class="type">ProcessInfo</span>.<span class="property">processInfo</span>.<span class="property">arguments</span>[<span class="number">1</span>...]

<span class="call">print</span>(<span class="string">"Hello, world!"</span>)
</code></pre><p>ä½¿ç”¨ ArgumentParser ä½¿ Swift å¯ä»¥è®€å– Argumentsã€‚</p><pre><code><span class="keyword">let</span> parser = <span class="type">ArgumentParser</span>(usage: <span class="string">"&lt;options&gt;"</span>, overview: <span class="string">"A Swift command-line tool to say hello"</span>)
<span class="keyword">let</span> nameArgument = parser.<span class="call">add</span>(option: <span class="string">"--name"</span>, shortName: <span class="string">"-n"</span>, kind: <span class="type">String</span>.<span class="keyword">self</span>, usage: <span class="string">"The name to greeting"</span>)
<span class="keyword">let</span> repeatArgument = parser.<span class="call">add</span>(option: <span class="string">"--repeat"</span>, shortName: <span class="string">"-r"</span>, kind: <span class="type">Int</span>.<span class="keyword">self</span>, usage: <span class="string">"The repeat count of Hello"</span>)
</code></pre><p>æˆ‘å€‘å»ºç«‹äº†å–®ä¸€ Parserï¼ŒåŠ å…¥å…©å€‹å¯ç”¨çš„åƒæ•¸ï¼Œ<code>--name</code> å’Œ <code>--repeat</code>ï¼Œé€é shortName çš„åƒæ•¸å»ºç«‹å„è‡ªçš„åˆ¥åï¼Œkind å‰‡å»ºç«‹æŒ‡å®šçš„ Swift å‹åˆ¥ã€‚</p><p>æ¥ä¸‹ä¾†æˆ‘å€‘é€éé‚è¼¯å®Œæˆé€™å€‹æ‡‰ç”¨ç¨‹å¼ã€‚</p><pre><code><span class="keyword">import</span> SPMUtility
<span class="keyword">import</span> Foundation

<span class="keyword">let</span> arguments = <span class="type">ProcessInfo</span>.<span class="property">processInfo</span>.<span class="property">arguments</span>[<span class="number">1</span>...]

<span class="keyword">let</span> parser = <span class="type">ArgumentParser</span>(usage: <span class="string">"&lt;options&gt;"</span>, overview: <span class="string">"A Swift command-line tool to say hello"</span>)
<span class="keyword">let</span> nameArgument = parser.<span class="call">add</span>(option: <span class="string">"--name"</span>, shortName: <span class="string">"-n"</span>, kind: <span class="type">String</span>.<span class="keyword">self</span>, usage: <span class="string">"The name to greeting"</span>)
<span class="keyword">let</span> repeatArgument = parser.<span class="call">add</span>(option: <span class="string">"--repeat"</span>, shortName: <span class="string">"-r"</span>, kind: <span class="type">Int</span>.<span class="keyword">self</span>, usage: <span class="string">"The repeat count of Hello"</span>)

<span class="keyword">do</span> {
    <span class="keyword">let</span> parsedArguments = <span class="keyword">try</span> parser.<span class="call">parse</span>(<span class="type">Array</span>(arguments))
    <span class="keyword">let</span> name = parsedArguments.<span class="call">get</span>(nameArgument) ?? <span class="string">"world"</span>
    <span class="keyword">var</span> repeatCount = parsedArguments.<span class="call">get</span>(repeatArgument) ?? <span class="number">0</span>
	repeatCount = repeatCount &gt; <span class="number">0</span> ? repeatCount : <span class="number">1</span>
	<span class="keyword">var</span> helloRepeat = [<span class="string">"Hello"</span>]
	<span class="keyword">for _ in</span> <span class="number">1</span>..&lt;repeatCount {
		helloRepeat.<span class="call">append</span>(<span class="string">"hello"</span>)
	}
	<span class="keyword">let</span> holloSentence = helloRepeat.<span class="call">joined</span>(separator: <span class="string">", "</span>)
    <span class="call">print</span>(<span class="string">"</span>\(holloSentence)<span class="string">,</span> \(name)<span class="string">"</span>)
} <span class="keyword">catch</span> {
    <span class="call">print</span>(<span class="string">"helloworld greeting failed:</span> \(error)<span class="string">"</span>)
}

</code></pre><p>ç¾åœ¨ï¼Œæˆ‘å€‘ä¾†æ¸¬è©¦çœ‹çœ‹ï¼åœ¨ terminal è£¡åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œä½ æ‡‰è©²çœ‹åˆ°æ‡‰ç”¨ç¨‹å¼çš„çµæœã€‚</p><pre><code>$ swift run helloworld --name yu --<span class="keyword">repeat</span> <span class="number">3</span>
<span class="type">Hello</span>, hello, hello, yu
</code></pre><p>ArgumentParser åŒæ™‚ä¹Ÿæä¾› <code>--help</code> çš„åŠŸèƒ½ã€‚</p><pre><code>$ swift run swift run helloworld --help
<span class="type">OVERVIEW</span>: <span class="type">A Swift</span> command-line tool to say hello

<span class="type">USAGE</span>: helloworld &lt;options&gt;

<span class="type">OPTIONS</span>:
  --name, -n     <span class="type">The</span> title to greeting
  --<span class="keyword">repeat</span>, -r   <span class="type">The</span> <span class="keyword">repeat</span> count of <span class="type">Hello</span>
  --help         <span class="type">Display</span> available options
</code></pre><h2>å°‡ SPM æ‰“åŒ…ä¸¦å®‰è£åˆ° Unix ä¸Š</h2><p>åœ¨ç¶“æ­·äº†å„ç¨®æ¸¬è©¦å¾Œï¼Œæˆ‘å€‘çš„ helloworld å·²ç¶“å¯ä»¥ä½œç‚ºä¸€å€‹æ—¥å¸¸çš„ä½¿ç”¨å·¥å…·ï¼Œé€éä»¥ä¸‹çš„æ–¹å¼ï¼Œå°‡åŸ·è¡Œæª”å®‰è£åˆ° terminal ä¸Šã€‚</p><pre><code>$ swift build --configuration release
$ cp -f .<span class="dotAccess">build</span>/release/helloworld /usr/local/bin/helloworld
</code></pre><p>å¦‚æ­¤ä¸€ä¾†ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ï¼</p><pre><code>$ helloworld --help
<span class="type">OVERVIEW</span>: <span class="type">A Swift</span> command-line tool to say hello

<span class="type">USAGE</span>: helloworld &lt;options&gt;

<span class="type">OPTIONS</span>:
  --name, -n     <span class="type">The</span> title to greeting
  --<span class="keyword">repeat</span>, -r   <span class="type">The</span> <span class="keyword">repeat</span> count of <span class="type">Hello</span>
  --help         <span class="type">Display</span> available options
</code></pre><p>ä»¥ä¸Šï¼Œå°±æ˜¯å¦‚ä½•è£½ä½œä¸€å€‹CLIï¼</p></div><span>Tagged with: </span><ul class="tag-list"><li class="variant-s"><a href="/tags/swift">swift</a></li><li class="variant-c"><a href="/tags/cli">cli</a></li><li class="variant-s"><a href="/tags/spm">spm</a></li><li class="variant-é¼ "><a href="/tags/é¼ å¹´å…¨é¦¬éµäººæŒ‘æˆ°">é¼ å¹´å…¨é¦¬éµäººæŒ‘æˆ°</a></li></ul></article></div><div class="fb-comments" colorscheme="dark" data-width="10" data-herf="https://ytyubox.github.io/posts/SwiftCLI-helloworld" data-numposts="10"></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a>, 100% Swift</p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>